stacks: [media-service]
regions: [eu-west-1]
templates:
  lambda:
    type: aws-lambda
    parameters:
      bucket: atom-maker-dist
      prefixStack: false
deployments:
  media-atom-maker-ami-update:
      type: ami-cloudformation-parameter
      app: media-atom-maker
      parameters:
        amiTags:
          Recipe: editorial-tools-basic
          AmigoStage: PROD
  media-atom-maker:
    type: autoscaling
    parameters:
      bucket: atom-maker-dist
    dependencies:
      - media-atom-maker-ami-update
  media-atom-upload-actions:
    template: lambda
    parameters:
      functionNames: [media-atom-maker-upload-actions-]
      fileName: media-atom-uploader.zip
  media-atom-expirer:
    template: lambda
    parameters:
      functionNames: [media-atom-maker-expirer-]
      fileName: media-atom-expirer.zip
  pluto-message-ingestion:
    template: lambda
    parameters:
      functionNames: [pluto-message-ingestion-]
      fileName: pluto-message-ingestion.zip

  media-atom-pipeline-cloudformation:
    type: cloud-formation
    app: media-atom-pipeline
    parameters:
      templatePath: media-atom-pipeline.yaml

  media-atom-pipeline-lambdas:
    type: aws-lambda
    parameters:
      bucket: atom-maker-dist
      functionNames:
        - "-GetChunkFromS3-"
        - "-UploadChunkToYouTube-"
        - "-CreateCompleteVideoInS3-"
        - "-SendToPluto-"
        - "-SendToTranscoder-"
        - "-GetTranscodingProgress-"
        - "-AddAssetToAtom-"
    dependencies:
      - media-atom-pipeline-cloudformation
